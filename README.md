aws홈페이지에서 vpc검색 → vpc생성 → 생성할 리소스(VPC만), CIDR블럭 10.0.0.0/16으로 설정 → vpc생성 

- 서버는 서울서버 타 서버 선택 주의!!!

서브넷 생성 →
![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/1d9aba2b-7aef-459c-9952-47ce9796e86b/2f07991a-bc72-42c0-965b-b29e6d985b43/image.png)
VPC ID에서 방금만든 vpc선택 → 아래처럼 서브넷 설정(총 4개)

public subnet a

- 이름 : public-subnet-a
- 가용 영역 : ap-northeast-2a
- CIDR : 10.0.0.0/24

public subnet b

- 이름 : public-subnet-b
- 가용 영역 : ap-northeast-2b
- CIDR : 10.0.1.0/24

private subnet a

- 이름 : private-subnet-a
- 가용 영역 : ap-northeast-2a
- CIDR : 10.0.2.0/24

private subnet b

- 이름 : private-subnet-b
- 가용 영역 : ap-northeast-2b
- CIDR : 10.0.3.0/24

vpc가 인터넷과 통신할 수 있도록 internet gateway를 구성

인터넷 게이트웨이 생성 → 이름태그를 igw로 설정 → 인터넷 게이트웨이 생성  

방금 만든 인터넷게이트웨이 선택후 작업에서 vpc연결 클릭후 자신이 만든 vpc선택후 인터넷게이트웨이 생성하기

이렇게 되면 vpc와 인터넷게이트웨이가 통신할 기반이 마련됨

public subnet에서도 필요한 패키지등을 다운받기위해서는 인터넷이 필요하므로 NAT gateway를 생성

NAT gateway는 private subnet이 인터넷게이트웨이와 통신을 할수있도록 만들어주는 징검다리와 같은 역할을 합니다.

NAT 게이트웨이 생성 → NAT 게이트웨이의 이름을 nat-a로 설정 → 서브넷을 연결하고자하는 private subnet을 선택 → 탄력적 IP할당(실수나 고의로 여러번 눌러서 여러개 생성시 사용을 안해도 돈이 나가니 탄력적ip에서 잘못할당받은 ip들을 선택후 작업에서 릴리즈를 선택하여 지울것!!!) → 이미 있을시 그것을 선택후 NAT 게이트웨이 생성

이젠 인터넷 통신을 위한 라우팅 설정을 한다

라우팅 테이블 생성 → 이름을 public-rt로 설정, vpc는 만들어놓은 vpc선택 → 아래와 같이 테이블 구성

- public-rt
- private-rt-a
- private-rt-b
-완성본

다음으로 라우팅과 서브넷을 연결을 해줍니다.

public-rt를 선택후 아래의 라우팅 → 라우팅 편집 → 라우팅 추가(대상 : 0.0.0.0/0, 대상 : 인터넷 게이트웨이 - 아까 만들어두었던 인터넷 게이트웨이 선택) → 변경사항 저장
나머지 라우팅 테이블들은 private서버에 연결을 위해 대상을 인터넷 게이트웨이가 아닌 아까 만들어두었던 NAT 게이트웨이로 설정을 합니다.
이제 public-rt를 선택후 서브넷 연결 → 서브넷 연결 편집

각각의 라우팅 테이블에 맞는 서브넷을 연결합니다.

- public-rt ← public-subnet-a, public-subnet-b
- private-rt-a ← private-subnet-a
- private-rt-b ← private-subnet-b

이렇게 완성했으면 기본 네트워크 설정은 끝났습니다.

과제 구성과 채점에 필요한 서버를 구성하겠습니다.

EC2는 AWS에서 컴퓨터를 대여하는 서비스라고 생각하면 됩니다.

앞으로 과제에 필요한 컴퓨팅 리소스를 EC2에서 사용할 것입니다.

EC2를 검색하여 대시보드에 들어갑니다. 

인스턴스 → 인스턴스 시작 → 이름에는 bastion-server, 인스턴트 유형은 t3.small을 선택(프리플랜 적용X) → 키페어 생성

우리는 Putty로 접속할것이니 .ppk로 설정합니다.

이제 네트워크 설정에서 VPC와 서브넷을 지정하고 외부에서 접속을 해야 하기 때문에 퍼블릭ip를 활성화해주고 퍼블릭 서브넷을 선택합니다.

보안그룹 생성을 선택후 보안그룹의 이름을 지정하고 shs로 접속하기 때문에 22번 포트를 지정합니다.

채점을 위해서 필요한 권한을 지정해줄겁니다.

새 IAM 프로파일을 선택합니다.

이제 IAM 콘솔로 오게 되는데 역할 생성을 선택합니다

사용 사례에 서비스또는 사용 사례에 EC2에 권한을 부여하기 때문에 EC2로 선택

실습에서는 모든 권한을 위해 Admin권한을 준다

!!! 과제에서는 주워지는 권한을 사용해야함 !!!

마지막으로 이름을 지정하고 생성해준다

다 생성했다면 다시 EC2로 돌아와서 인스턴스 프로필을 지정하고 생성해줍니다.

이제 인스턴스가 생성되었다면 고정 ip를 할당할 차례입니다.

네트워크 및 보안에 탄력적IP에 탄력적 IP 주소 할당을 누르고 아무 설정도 하지않고 할당을 해줍니다.

이제 방금 할당한 탄력적IP를 선택후 작업에서 탄력적 IP 주소 연결을 해줍니다.

이제 만들어놓은 인스턴스 유형을 선택하고 인스턴스와 프라이빗 IP주소를 선택합니다.

생성한 IP와 인스턴스의 public ip가 같은걸 확인할 수 있습니다.

이렇게 되면 정상적으로 고정ip를 할당해 준 것입니다.

이제 접속이 되는지 확인 하겠습니다.

그 전에 putty를 설치합니다.

Host Name에 인스턴스의 public ip를 입력하고 Port는 접속할 수 있는 포트 번호를 입력합니다.

ssh로 접근하기 위해서는 key가 필요합니다.

key는 인스턴스를 만들 때 같이 만들었던 keypair를 사용합니다.

Connection → SSH → Auth → Credentials에서 다운로드 되었던 ppk파일을 넣으면 됩니다.

그리고 open을 클릭합니다.

이제 대충 ec2-user를 입력하면 짹짹이가 나옵니다. 그럼 성공!!!

S3는 AWS에서 제공하는 스토리지 서비스입니다.

파일을 저장하고 사용할 수 있습니다. 웹 호스팅도 할 수 있습니다.

실습에 필요한 어플리케이션 파일을 업로드하기 위한 S3 Bucket을 만들겠습니다.

버킷 만들기를 클릭합니다.

버킷의 이름을 지정합니다.

버킷의 이름은 중복될 수 없습니다.

객체 소유권은 누가 객체를 소유할 것인지 지정해줄 수 있는 옵션입니다.

저희는 EC2에서 코드를 다운받아 사용해야 하기 때문에 퍼블릭 액세스 차단을 해제합니다.

`app.py`, `index.html` 파일을 업로드합니다.

다음은 저희가 파일을 다운받을 수 있게 정책을 설정해줘야 합니다.

ARN 부분에는 `<아까 복사한 ARN>/*` 이렇게 넣어줍니다. (S3의 모든 객체에 대해 적용하는 것입니다.)

- **Principal**: 어떤 사용자에 대한 권한을 설정할 것인가? (모든 사용자에 대해 설정하겠습니다.)
- **Action**: 어떤 행동에 대한 권한을 지정할 것인가? (모든 행동에 대해 설정하겠습니다.)
- **Resource**: 어떤 리소스에 대한 권한을 지정할 것인가? (아까 만든 버킷의 모든 객체에 대해 설정하겠습니다.)
- **Effect**: 허용, 거부를 지정합니다.

이렇게 설정하면 모든 사용자에게 모든 권한을 주는 정책이 생성됩니다.

다 작성했으면 **Add Statement**를 하고 **Generate Policy**를 합니다.

나온 정책을 복사합니다.

복사한 정책을 붙여넣고 변경 사항을 저장합니다.

이렇게 하면 버킷을 생성하고 객체에 대한 정책을 지정하는 부분까지 완료가 됩니다.


1. ASG 생성 시작
먼저 Auto Scaling 그룹 생성 버튼을 클릭합니다.
ASG 이름을 입력하여 그룹을 식별할 수 있도록 설정합니다.

ASG를 만들기 위해서는 시작 템플릿이 필요합니다.
템플릿은 EC2 인스턴스의 기본 설정을 정의하며, ASG가 인스턴스를 생성할 때 이 설정을 기반으로 사용합니다.

2. 시작 템플릿 생성
시작 템플릿 생성 버튼을 클릭합니다.
다음으로 템플릿 이름을 입력하고 EC2 Auto Scaling 지침 옵션을 선택합니다.
이후 템플릿의 기본 OS 이미지를 선택합니다(AWS에서 제공하는 이미지 중 하나를 선택).
인스턴스 유형을 지정한 뒤 키페어는 필요에 따라 생성하지 않아도 괜찮습니다.

서브넷 설정
ASG 설정에서 서브넷을 지정할 예정이므로 지금은 서브넷을 포함하지 않습니다.

3. 보안 그룹 생성
EC2 인스턴스는 보안 그룹을 통해 네트워크 트래픽을 관리합니다.
새로운 보안 그룹을 생성하거나 미리 생성된 것을 선택할 수 있습니다.

보안 그룹 이름과 VPC를 지정합니다.
실습에서는 Python Flask로 개발된 앱을 배포하므로 Flask 기본 포트인 5000번 포트를 열어줍니다.
(배포 환경에 따라 필요한 포트를 열어주세요.)
리소스 태그 추가
리소스 태그에 인스턴스 이름을 지정합니다.
예를 들어, 이 템플릿으로 실행되는 인스턴스는 practice-app이라는 태그를 가지게 됩니다.

4. S3와의 연동
앞서 생성했던 S3 버킷에 애플리케이션 코드를 업로드했습니다.
ASG의 EC2 인스턴스가 S3에서 애플리케이션 코드를 가져오려면 S3 객체를 읽을 수 있는 권한이 필요합니다.

IAM 역할 생성
새 IAM 프로파일 생성 버튼을 클릭합니다.
Bastion Server 역할을 생성할 때와 비슷한 방식으로 진행하되, 이번에는 AmazonS3ReadOnlyAccess 정책을 부여합니다.
생성한 역할의 이름을 지정한 뒤 템플릿 설정에 추가합니다.

5. 사용자 데이터 설정
이제 애플리케이션을 실행하기 위한 설정을 진행합니다.
먼저 S3 버킷에서 파이썬 코드 파일의 URI를 복사한 뒤, 사용자 데이터에 스크립트를 추가합니다.

아래는 S3에서 애플리케이션 파일을 다운로드하고 실행하는 예제 스크립트입니다:

bash
코드 복사
#!/bin/bash
aws s3 cp s3://2024-cloud-practice-bucket/app.py .
yum install python3-pip -y
pip install flask
nohup python3 app.py &
이 스크립트는 루트 권한으로 실행되므로 sudo 명령어를 붙일 필요가 없습니다.
스크립트를 입력한 뒤 템플릿을 저장하면 시작 템플릿 생성이 완료됩니다.


ASG(Auto Scaling Group)는 꼭 알아야 할 중요한 AWS 서비스 중 하나입니다.
ASG를 활용하면 서버의 수요에 따라 확장하거나 축소할 수 있어 자원을 효율적으로 관리할 수 있습니다.
지금부터 ASG를 생성하고 설정하는 과정을 차근차근 살펴보겠습니다.

1. ASG 생성 시작
먼저 Auto Scaling 그룹 생성 버튼을 클릭합니다.
ASG 이름을 입력하여 그룹을 식별할 수 있도록 설정합니다.

ASG를 만들기 위해서는 시작 템플릿이 필요합니다.
템플릿은 EC2 인스턴스의 기본 설정을 정의하며, ASG가 인스턴스를 생성할 때 이 설정을 기반으로 사용합니다.

2. 시작 템플릿 생성
시작 템플릿 생성 버튼을 클릭합니다.
다음으로 템플릿 이름을 입력하고 EC2 Auto Scaling 지침 옵션을 선택합니다.
이후 템플릿의 기본 OS 이미지를 선택합니다(AWS에서 제공하는 이미지 중 하나를 선택).
인스턴스 유형을 지정한 뒤 키페어는 필요에 따라 생성하지 않아도 괜찮습니다.

서브넷 설정
ASG 설정에서 서브넷을 지정할 예정이므로 지금은 서브넷을 포함하지 않습니다.

3. 보안 그룹 생성
EC2 인스턴스는 보안 그룹을 통해 네트워크 트래픽을 관리합니다.
새로운 보안 그룹을 생성하거나 미리 생성된 것을 선택할 수 있습니다.

보안 그룹 이름과 VPC를 지정합니다.
실습에서는 Python Flask로 개발된 앱을 배포하므로 Flask 기본 포트인 5000번 포트를 열어줍니다.
(배포 환경에 따라 필요한 포트를 열어주세요.)
리소스 태그 추가
리소스 태그에 인스턴스 이름을 지정합니다.
예를 들어, 이 템플릿으로 실행되는 인스턴스는 practice-app이라는 태그를 가지게 됩니다.

4. S3와의 연동
앞서 생성했던 S3 버킷에 애플리케이션 코드를 업로드했습니다.
ASG의 EC2 인스턴스가 S3에서 애플리케이션 코드를 가져오려면 S3 객체를 읽을 수 있는 권한이 필요합니다.

IAM 역할 생성
새 IAM 프로파일 생성 버튼을 클릭합니다.
Bastion Server 역할을 생성할 때와 비슷한 방식으로 진행하되, 이번에는 AmazonS3ReadOnlyAccess 정책을 부여합니다.
생성한 역할의 이름을 지정한 뒤 템플릿 설정에 추가합니다.

5. 사용자 데이터 설정
이제 애플리케이션을 실행하기 위한 설정을 진행합니다.
먼저 S3 버킷에서 파이썬 코드 파일의 URI를 복사한 뒤, 사용자 데이터에 스크립트를 추가합니다.

아래는 S3에서 애플리케이션 파일을 다운로드하고 실행하는 예제 스크립트입니다:

bash
코드 복사
#!/bin/bash
aws s3 cp s3://2024-cloud-practice-bucket/app.py .
yum install python3-pip -y
pip install flask
nohup python3 app.py &
이 스크립트는 루트 권한으로 실행되므로 sudo 명령어를 붙일 필요가 없습니다.
스크립트를 입력한 뒤 템플릿을 저장하면 시작 템플릿 생성이 완료됩니다.

6. ASG 생성 완료
이제 다시 ASG 생성 단계로 돌아와, 방금 만든 시작 템플릿을 선택합니다.
EC2 인스턴스가 배치될 위치를 설정해야 합니다.
실습에서는 Private 서브넷 두 개를 선택하여 배치할 예정입니다.

7. 로드 밸런서 설정
로드 밸런서는 애플리케이션의 트래픽을 분산시키는 데 사용됩니다.
스케일링된 인스턴스들이 자동으로 로드 밸런서에 등록되도록 설정할 수 있습니다.

로드 밸런서 생성
로드 밸런서 탭으로 이동해 로드 밸런서 생성을 클릭합니다.
애플리케이션 로드 밸런서를 선택합니다.
로드 밸런서의 이름을 지정하고, 인터넷 접근 방식을 internet-facing으로 설정합니다.
로드 밸런서를 생성할 VPC와 Public 서브넷을 선택합니다.
보안 그룹 추가
새로운 보안 그룹을 생성합니다:

이름과 VPC를 지정합니다.
HTTP 요청을 받을 것이므로 80번 포트를 열어줍니다.
소스는 0.0.0.0/0으로 설정하여 모든 IP에서 접속 가능하도록 합니다.

8. 대상 그룹 설정
로드 밸런서를 통해 트래픽을 전달받을 EC2 인스턴스를 정의하는 대상 그룹을 생성합니다:

대상 그룹 생성을 클릭합니다.
유형을 인스턴스로 선택합니다.
대상 그룹 이름을 입력합니다.
프로토콜은 HTTP, 포트는 Flask 앱의 기본 포트인 5000번으로 설정합니다.
상태 검사 경로는 /health로 지정합니다.
상태 검사 간격은 실습에서는 가장 짧게 설정합니다.
9. ASG와 로드 밸런서 연결
ASG에 로드 밸런서를 등록하면, 인스턴스가 자동으로 대상 그룹에 추가됩니다.
이 설정을 마치면 Auto Scaling Group과 로드 밸런서 구성이 완료됩니다.





